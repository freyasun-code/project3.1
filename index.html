<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Project 3A: Image Warping and Mosaicing</title>
  <style>
    body {
      background-color: #D8C3DD;
      font-family: Arial, sans-serif;
      color: white;
      margin: 0;
      padding: 0;
    }
    nav {
      background: rgba(0, 0, 0, 0.3);
      padding: 10px 20px;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    nav a {
      color: #ffddff;
      text-decoration: none;
      margin: 0 15px;
      font-weight: bold;
    }
    nav a:hover {
      text-decoration: underline;
    }
    .container {
      width: 90%;
      margin: auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-top: 20px;
    }
    .section {
      background: rgba(0,0,0,0.25);
      padding: 30px;
      margin: 40px 0;
      border-radius: 12px;
    }
    .section h2 {
      color: #ffddff;
      text-align: center;
    }
    img {
      max-width: 100%;
      border-radius: 8px;
    }
    .row {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .img-block {
      text-align: center;
    }
    .img-block p {
      margin-top: 8px;
      font-size: 16px;
      text-align: center;
    }
    p {
      text-align: left;
      max-width: 1000px;
      margin: auto;
      margin-bottom: 20px;
      font-size: 18px;
    }
  </style>
</head>

<body>
  <nav>
    <a href="#A1">A.1</a>
    <a href="#A2">A.2</a>
    <a href="#A3">A.3</a>
    <a href="#A4">A.4</a>
  </nav>

  <div class="container">
    <h1>Project 3A: Image Warping and Mosaicing</h1>
    <p style="text-align:center; font-style:italic;">Freya Sun</p>

<!-- A.1 -->
<div class="section" id="A1">
  <h2>A.1: Shoot the Pictures</h2>
  <p>Here are my three sets of images.</p>

  <div class="row">
    <div class="img-block">
      <img src="tower-left.jpg" alt="tower left" width="350">
      <p>tower-left</p>
    </div>
    <div class="img-block">
      <img src="tower-right.jpg" alt="tower right" width="350">
      <p>tower-right</p>
    </div>
  </div>

  <div class="row">
    <div class="img-block">
      <img src="library-left.jpg" alt="library left" width="300">
      <p>library-left</p>
    </div>
    <div class="img-block">
      <img src="library-middle.jpg" alt="library middle" width="300">
      <p>library-middle</p>
    </div>
    <div class="img-block">
      <img src="library-right.jpg" alt="library right" width="300">
      <p>library-right</p>
    </div>
  </div>

  <div class="row">
    <div class="img-block">
      <img src="street-left.jpg" alt="street left" width="300">
      <p>street-left</p>
    </div>
    <div class="img-block">
      <img src="street-middle.jpg" alt="street middle" width="300">
      <p>street-middle</p>
    </div>
    <div class="img-block">
      <img src="street-right.jpg" alt="street right" width="300">
      <p>street-right</p>
    </div>
  </div>
</div>

<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>A.2: Recovering the Homography</title>

  <!-- MathJax configuration -->

  <script>
  window.MathJax = {
    tex: {
      inlineMath: [['\\(','\\)']],
      displayMath: [['\\[','\\]']]
    },
    options: {
      skipHtmlTags: ['script','noscript','style','textarea','pre','code']
    }
  };
  </script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <!-- Basic layout styles -->

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      line-height: 1.6;
      background-color: #fafafa;
      color: #333;
    }
    h2, h3, h4 {
      color: #003366;
    }
    .section {
      margin-bottom: 60px;
    }
    .row {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      margin-top: 25px;
    }
    .img-block {
      text-align: center;
    }
    img {
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    pre {
      background: #f4f4f4;
      border-radius: 6px;
      padding: 14px;
      font-family: Consolas, monospace;
      font-size: 14px;
      overflow-x: auto;
    }
  </style>

</head>

<body>

<div class="section" id="A2">
  <h2>A.2: Recovering the Homography</h2>

  <h3>computeH(im1_pts, im2_pts) function:</h3>

  <div style="text-align:center;">
    <pre style="display:inline-block; text-align:left;">
def computeH(src_pts, dst_pts):
    assert src_pts.shape == dst_pts.shape and src_pts.shape[0] >= 4
    num_points = src_pts.shape[0]
    A = []
    b = []
    for i in range(num_points):
        x, y = src_pts[i, :]
        u, v = dst_pts[i, :]
        A.append([x, y, 1, 0, 0, 0, -u*x, -u*y])
        A.append([0, 0, 0, x, y, 1, -v*x, -v*y])
        b.append(u)
        b.append(v)
    A = np.array(A)
    b = np.array(b)
    h, _, _, _ = np.linalg.lstsq(A, b, rcond=None)
    H = np.append(h, 1).reshape(3, 3)
    return H
    </pre>
  </div>

  <h3>Recovered Homography Matrix H:</h3>

  <div style="text-align:center;">
    <pre style="display:inline-block; text-align:center;">
      [  1.82  -0.05 -888.37 ]
      [  0.36   1.50 -404.83 ]
      [  0.00   0.00    1.00 ]
    </pre>
  </div>

  <h3>System of Equations:</h3>

  <p>
    To align one image to another, we need to find a <strong>homography matrix</strong> \( H \) that maps a point 
    \((x, y)\) in the first image to its corresponding point \((u, v)\) in the second image:
  </p>

  <div style="text-align:center;">
    \[
    \lambda
    \begin{bmatrix}
    u \\ v \\ 1
    \end{bmatrix}
    =
    H
    \begin{bmatrix}
    x \\ y \\ 1
    \end{bmatrix}
    \]
  </div>

  <p>where \(\lambda\) is an arbitrary scale factor and \(H\) has 8 degrees of freedom (we set the 9th element to 1).</p>

  <h4>Setting up the Linear System</h4>

  <div style="text-align:center;">
    \[
    u = \frac{h_1 x + h_2 y + h_3}{h_7 x + h_8 y + 1}, \qquad
    v = \frac{h_4 x + h_5 y + h_6}{h_7 x + h_8 y + 1}
    \]
  </div>

  <p>
    Multiplying through by the denominator and rearranging gives two linear equations per correspondence:
  </p>

  <div style="text-align:center;">
    \[
    \begin{cases}
    h_1 x + h_2 y + h_3 - u(h_7 x + h_8 y) = u, \\
    h_4 x + h_5 y + h_6 - v(h_7 x + h_8 y) = v.
    \end{cases}
    \]
  </div>

  <p>
    Written in matrix form (two rows per correspondence):
  </p>

  <div style="text-align:center;">
    \[
    \begin{bmatrix}
    x & y & 1 & 0 & 0 & 0 & -u x & -u y \\
    0 & 0 & 0 & x & y & 1 & -v x & -v y
    \end{bmatrix}
    \begin{bmatrix}
    h_1 \\ h_2 \\ h_3 \\ h_4 \\ h_5 \\ h_6 \\ h_7 \\ h_8
    \end{bmatrix}
    =
    \begin{bmatrix}
    u \\ v
    \end{bmatrix}
    \]
  </div>

  <h4>Solving</h4>

  <p>
    With \(N\) correspondences we have \(2N\) equations, which we can solve via least squares:
  </p>

  <div style="text-align:center;">
    \[
    h = \operatorname*{argmin}_h \|A h - b\|^2
    \]
  </div>

  <p style="text-align:center; font-style:italic;">
    The final 3Ã—3 homography matrix is formed by appending 1 to complete \( H \):
  </p>

  <div style="text-align:center;">
    \[
    H =
    \begin{bmatrix}
    h_1 & h_2 & h_3 \\
    h_4 & h_5 & h_6 \\
    h_7 & h_8 & 1
    \end{bmatrix}
    \]
  </div>

  <h3>Correspondences Visualized on the Images:</h3>

  <div class="row">
    <div class="img-block">
      <img src="im1_points.jpg" alt="image 1 correspondences" width="420">
      <p>Image 1 (Left)</p>
    </div>
    <div class="img-block">
      <img src="im2_points.jpg" alt="image 2 correspondences" width="420">
      <p>Image 2 (Right)</p>
    </div>
  </div>

</div>

</body>
</html>


<!-- A.3 -->

<div class="section" id="A3">
  <h2>A.3: Warp the Images</h2>

  <p>
    After computing the homography matrix \( H \), we can use it to warp an image into the reference frame of another. 
    To do this, we implemented two functions:
  </p>

  <div style="text-align:center;">
    <pre style="display:inline-block; text-align:left;">
imwarped_nn = warpImageNearestNeighbor(im, H)
imwarped_bil = warpImageBilinear(im, H)
    </pre>
  </div>

  <p>
    We use <strong>inverse warping</strong> to avoid holes in the output image. 
    For each pixel in the output, its position is mapped backward using \( H^{-1} \) 
    to find the corresponding coordinates in the input image.
  </p>

  <p>
    Two interpolation methods were implemented from scratch:
  </p>

  <ul>
    <li><strong>Nearest Neighbor Interpolation:</strong> Each output pixel takes the value of the closest input pixel.</li>
    <li><strong>Bilinear Interpolation:</strong> Each output pixel is computed as a weighted average of its four neighboring input pixels.</li>
  </ul>

  <h3>Results and Discussion</h3>

  <p>
    The <em>Nearest Neighbor</em> interpolation ran faster 
    (<strong>1.46 seconds</strong>), but produced visible jagged edges along diagonal lines and object boundaries.  
    The <em>Bilinear</em> interpolation took longer (<strong>2.76 seconds</strong>), 
    yet yielded smoother transitions and overall better visual quality.
  </p>

  <p>
    Both methods successfully warped the images using inverse mapping, and we applied them for <strong>rectification</strong>. 
    For example, by selecting four corners of a rectangular region (such as a poster or a laptop screen) and 
    defining a perfect rectangle as the target coordinates, 
    the warped image was corrected so that the originally distorted rectangle appears truly rectangular.
  </p>

  <div class="row">
    <div class="img-block">
      <img src="macbook.jpg" alt="original macbook" width="300">
      <p>Original Image</p>
    </div>
    <div class="img-block">
      <img src="macbook_nearest_neighbor.jpg" alt="nearest neighbor" width="300">
      <p>Nearest Neighbor Result</p>
    </div>
    <div class="img-block">
      <img src="macbook_bilinear.jpg" alt="bilinear" width="300">
      <p>Bilinear Result</p>
    </div>
  </div>

  <div class="row">
    <div class="img-block">
      <img src="book.jpg" alt="original book" width="300">
      <p>Original Image</p>
    </div>
    <div class="img-block">
      <img src="book_nearest_neighbor.jpg" alt="book nearest neighbor" width="300">
      <p>Nearest Neighbor Result</p>
    </div>
    <div class="img-block">
      <img src="book_bilinear.jpg" alt="book bilinear" width="300">
      <p>Bilinear Result</p>
    </div>
  </div>
</div>

<!-- A.4 -->

<div class="section" id="A4">
  <h2>A.4: Blend the Images into a Mosaic</h2>

  <p>
    In this part, I combined multiple images into a single seamless mosaic using the computed homographies.  
    The left and right images were both warped into the coordinate system of the middle image, 
    so that all three images align in a common reference frame.
  </p>

  <p>
    After warping, I implemented two blending approaches to reduce visible seams:
  </p>

  <ul>
    <li><strong>Weighted Averaging (Alpha Feathering):</strong> 
      The alpha value is set to 1 at the center of each image and gradually falls to 0 near the edges, 
      based on the distance transform. This smooth transition helps avoid harsh boundaries between images.
    </li>
    <li><strong>Laplacian Pyramid Blending:</strong> 
      A multi-level blending method that combines images in both low and high frequency bands, 
      preserving edge details while minimizing ghosting artifacts. This produced smoother transitions and better color consistency.
    </li>
  </ul>

  <p>
    Since only eight pairs of correspondence points were selected and it was difficult to keep the phone perfectly centered during shooting, 
    some parts of the final mosaics are slightly misaligned and show mild ghosting.  
    Nonetheless, the overall alignment demonstrates that the homographies and blending pipeline worked as expected.
  </p>

  <div class="row">
    <div class="img-block">
      <img src="tower-mosaic_weighted.jpg" alt="tower weighted mosaic" width="400">
      <p>Weighted Averaging Mosaic (Tower)</p>
    </div>
    <div class="img-block">
      <img src="tower-mosaic_pyramid.jpg" alt="tower pyramid mosaic" width="400">
      <p>Laplacian Pyramid Mosaic (Tower)</p>
    </div>
  </div>

  <div class="row">
    <div class="img-block">
      <img src="library-mosaic_weighted.jpg" alt="library weighted mosaic" width="400">
      <p>Weighted Averaging Mosaic (Library)</p>
    </div>
    <div class="img-block">
      <img src="library-mosaic_pyramid.jpg" alt="library pyramid mosaic" width="400">
      <p>Laplacian Pyramid Mosaic (Library)</p>
    </div>
  </div>

  <div class="row">
    <div class="img-block">
      <img src="street-mosaic_weighted.jpg" alt="street weighted mosaic" width="400">
      <p>Weighted Averaging Mosaic (Street)</p>
    </div>
    <div class="img-block">
      <img src="street-mosaic_pyramid.jpg" alt="street pyramid mosaic" width="400">
      <p>Laplacian Pyramid Mosaic (Street)</p>
    </div>
  </div>
</div>


  </div>
</body>
</html>

